# Transaction Verifier Client

The transaction verifier client provides an easy way to interact with the [TX Verifier API](https://staging.services.docs.unity.com/iap-transaction-verifier/v1/)_(Currently only visible on staging)_ on the Game Gateway.

The client is code generated from the OpenAPI specification of the TX Verifier API. It provides a simple way to interact with the API using the generated client. The OpenApi spec used to generate the most recent version of this client can be found in this folder as `spec.yaml`.

The configuration for the generator can be found in this folder as `configuration.yaml`.

Documentation for the generator can be found here. [here](https://pages.prd.mz.internal.unity3d.com/unity-common-openapi-generators/docs/csharp-generator/).

## Transaction Verifier Client Usage

The code generated client lives in `./Client` but all access should remain internal.

There is a public facing facade in `./TransactionVerifier.cs` that should be used to interact with the client. The generic store agnostic response object from verification api can be found in `./VerificationResponse` (The codegen specific stores can be found here: `./Client/Model/AppleTransactionDto.cs` / `./Client/Model/GoogleTransactionDto.cs`).

**THE CLIENT REQUIRED AUTHENTICATION TO BE PRESENT AND THE PLAYER MUST BE SIGNED IN PRIOR TO INITIALIZING THE PURCHASING MANAGER**

## Generating The Client

If changes need to be made to the client, the client can be regenerated by following these steps:

1. If you don't already have it, you will need the generator jar. This can be found [here](https://pages.prd.mz.internal.unity3d.com/unity-common-openapi-generators/docs/csharp-generator/). **DO NOT SAVE IT TO VERSION CONTROL**
2. Retrieve the most up-to-date version of the spec from the TX Verifier API and save it in `./spec.yaml`.
3. Run the generator with the configuration file `./configuration.yaml`.
    ```bash
      java -jar ./path/to/generator.jar generate -c ./configuration.yaml
    ```
4. The generated client will be output to `./tmp-client`.
5. The client needs to be extraced and moved to `./Client`. To do this you can run:
    ```bash
      rm -rf ./Client && mkdir ./Client && mv ./tmp-client/com.unity.purchasing.transaction-verifier/Runtime/* ./Client/ && rm -rf ./tmp-client
    ```
6. The client is now ready to be used, the above command should clean up the ./tmp-client folder. as it is no longer needed.
